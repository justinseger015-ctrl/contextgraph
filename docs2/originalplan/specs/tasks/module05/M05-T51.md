# M05-T51: Implement Active Inference Interface Stubs

## Task Metadata
- **ID**: M05-T51
- **Title**: Implement Active Inference Interface Stubs
- **Module**: 05 - UTL Integration
- **Layer**: completion
- **Priority**: medium
- **Estimated Hours**: 2

## Description

Create active inference interface for epistemic actions per PRD Section 3.6.
Per constitution.yaml omni_infer and active_inference sections:
- EFE (Expected Free Energy) minimizes surprise + ambiguity
- Generate clarifying questions when coherence < 0.4

Create ActiveInferenceInterface trait with:
- compute_expected_entropy_reduction(action) -> f32
- generate_epistemic_action(utl_state) -> Option<EpistemicAction>
- should_trigger_active_inference(coherence) -> bool

EpistemicAction struct: action_type, question, expected_entropy_reduction.
Stub until Module 11 (Active Inference implementation).

## File Path

`crates/context-graph-utl/src/active_inference/interface.rs`

## Dependencies

| Task ID | Task Title | Status |
|---------|------------|--------|
| M05-T22 | UtlProcessor Orchestrator | pending |
| M05-T21 | LearningSignal and UtlState | pending |

## Acceptance Criteria

- [ ] ActiveInferenceInterface trait defined
- [ ] EpistemicAction struct with 3 fields
- [ ] should_trigger() uses coherence < 0.4 threshold
- [ ] Stub returns None for epistemic actions
- [ ] Interface ready for Module 11

## Test File

`crates/context-graph-utl/tests/active_inference_tests.rs`

## Specification References

- constitution.yaml omni_infer.active_inference
- PRD Section 3.6

## Implementation Notes

### EpistemicAction Struct

```rust
/// Represents an epistemic action generated by active inference.
/// Used to reduce uncertainty through clarifying questions or exploration.
#[derive(Debug, Clone, PartialEq)]
pub struct EpistemicAction {
    /// Type of epistemic action
    pub action_type: EpistemicActionType,
    /// Clarifying question or exploration prompt
    pub question: String,
    /// Expected entropy reduction from this action [0, 1]
    pub expected_entropy_reduction: f32,
}

/// Types of epistemic actions the system can generate.
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum EpistemicActionType {
    /// Ask a clarifying question to reduce ambiguity
    ClarifyingQuestion,
    /// Suggest exploring related context
    ExplorationSuggestion,
    /// Request confirmation of understanding
    ConfirmationRequest,
    /// Recommend retrieving specific information
    RetrievalRecommendation,
}
```

### ActiveInferenceInterface Trait

```rust
use crate::UtlState;

/// Active inference interface for epistemic action generation.
///
/// Per constitution.yaml omni_infer.active_inference and PRD Section 3.6,
/// this implements Expected Free Energy (EFE) minimization to reduce
/// surprise and ambiguity through epistemic actions.
pub trait ActiveInferenceInterface: Send + Sync {
    /// Compute expected entropy reduction for a given action.
    /// Higher values indicate more informative actions.
    fn compute_expected_entropy_reduction(&self, action: &EpistemicAction) -> f32;

    /// Generate an epistemic action based on current UTL state.
    /// Returns None if no action is warranted.
    fn generate_epistemic_action(&self, utl_state: &UtlState) -> Option<EpistemicAction>;

    /// Determine if active inference should be triggered.
    /// Per spec: triggers when coherence < 0.4
    fn should_trigger_active_inference(&self, coherence: f32) -> bool;
}
```

### Configuration

```rust
/// Configuration for active inference behavior.
#[derive(Debug, Clone, serde::Deserialize)]
pub struct ActiveInferenceConfig {
    /// Coherence threshold below which active inference triggers
    /// Default: 0.4 per constitution.yaml
    #[serde(default = "default_coherence_threshold")]
    pub coherence_threshold: f32,

    /// Minimum expected entropy reduction to generate action
    #[serde(default = "default_min_entropy_reduction")]
    pub min_entropy_reduction: f32,

    /// Enable active inference (false until Module 11)
    #[serde(default)]
    pub enabled: bool,
}

fn default_coherence_threshold() -> f32 { 0.4 }
fn default_min_entropy_reduction() -> f32 { 0.1 }
```

### Stub Implementation

```rust
/// Stub implementation that returns no epistemic actions until Module 11.
pub struct StubActiveInference {
    config: ActiveInferenceConfig,
}

impl StubActiveInference {
    pub fn new(config: ActiveInferenceConfig) -> Self {
        Self { config }
    }
}

impl Default for StubActiveInference {
    fn default() -> Self {
        Self {
            config: ActiveInferenceConfig {
                coherence_threshold: 0.4,
                min_entropy_reduction: 0.1,
                enabled: false,
            },
        }
    }
}

impl ActiveInferenceInterface for StubActiveInference {
    fn compute_expected_entropy_reduction(&self, _action: &EpistemicAction) -> f32 {
        // Stub: Return 0 (no entropy reduction computed)
        0.0
    }

    fn generate_epistemic_action(&self, _utl_state: &UtlState) -> Option<EpistemicAction> {
        // Stub: Return None until Module 11 implementation
        None
    }

    fn should_trigger_active_inference(&self, coherence: f32) -> bool {
        // Even in stub mode, respect the threshold logic
        self.config.enabled && coherence < self.config.coherence_threshold
    }
}
```

### Integration with UtlState

```rust
impl UtlState {
    /// Check if active inference should be considered.
    /// Convenience method that uses coherence value.
    pub fn should_consider_active_inference(&self) -> bool {
        self.coherence < 0.4
    }
}
```

## Verification Commands

```bash
# Run active inference tests
cargo test -p context-graph-utl active_inference

# Verify trait is object-safe (dyn ActiveInferenceInterface)
cargo check -p context-graph-utl

# Check that EpistemicAction has all 3 required fields
cargo test -p context-graph-utl epistemic_action_fields

# Verify default threshold is 0.4
cargo test -p context-graph-utl coherence_threshold_default
```

---

*Generated: 2026-01-04*
*Module: 05 - UTL Integration*
*Task: M05-T51*
