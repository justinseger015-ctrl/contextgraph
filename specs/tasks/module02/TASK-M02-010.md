# TASK-M02-010: Define GraphEdge Struct with Marblestone Fields

```xml
<task_spec id="TASK-M02-010" version="1.0">
<metadata>
  <title>Define GraphEdge Struct with Marblestone Fields</title>
  <status>blocked</status>
  <layer>foundation</layer>
  <module>module-02</module>
  <sequence>10</sequence>
  <priority>critical</priority>
  <estimated_hours>2</estimated_hours>
  <implements>
    <item>TECH-CORE-002 Section 2.5: GraphEdge specification</item>
    <item>Marblestone Integration Spec: Edge with NT weights and steering</item>
  </implements>
  <depends_on>
    <task_ref>TASK-M02-007</task_ref>
    <task_ref>TASK-M02-008</task_ref>
    <task_ref>TASK-M02-009</task_ref>
  </depends_on>
  <estimated_complexity>medium</estimated_complexity>
</metadata>

<context>
GraphEdge is the struct representing a directed relationship between two MemoryNodes. It includes the Marblestone architecture fields for neurotransmitter-based weight modulation, amortized shortcuts (learned during dream consolidation), and steering rewards. This is the primary edge type in the Context Graph and enables sophisticated context-aware traversal.
</context>

<input_context_files>
  <file purpose="Domain enum dependency">crates/context-graph-core/src/marblestone.rs</file>
  <file purpose="NeurotransmitterWeights dependency">crates/context-graph-core/src/marblestone.rs</file>
  <file purpose="EdgeType dependency">crates/context-graph-core/src/marblestone.rs</file>
  <file purpose="NodeId type alias">crates/context-graph-core/src/memory_node.rs</file>
  <file purpose="Constitution reference for edge model">docs2/constitution.yaml</file>
</input_context_files>

<prerequisites>
  <check>TASK-M02-007 (Domain enum) is complete</check>
  <check>TASK-M02-008 (NeurotransmitterWeights) is complete</check>
  <check>TASK-M02-009 (EdgeType enum) is complete</check>
</prerequisites>

<scope>
  <in_scope>
    - GraphEdge struct with 13 fields
    - EdgeId type alias for Uuid
    - Basic field accessors
    - Serde Serialize/Deserialize derives
    - Clone, Debug, PartialEq derives
    - Doc comments
  </in_scope>
  <out_of_scope>
    - GraphEdge methods (handled in TASK-M02-011)
    - Persistence/storage (handled in storage tasks)
  </out_of_scope>
</scope>

<definition_of_done>
  <signatures>
    <signature file="crates/context-graph-core/src/marblestone.rs">
use chrono::{DateTime, Utc};
use uuid::Uuid;

use crate::memory_node::NodeId;

/// Type alias for edge identifiers.
pub type EdgeId = Uuid;

/// A directed edge between two nodes in the Context Graph.
///
/// Implements Marblestone architecture features:
/// - Neurotransmitter-based weight modulation
/// - Amortized shortcuts (learned during dream consolidation)
/// - Steering rewards for reinforcement learning
///
/// # Performance Characteristics
/// - Serialized size: ~200 bytes
/// - Traversal latency target: &lt;50μs
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct GraphEdge {
    /// Unique identifier for this edge.
    pub id: EdgeId,

    /// Source node ID (edge starts here).
    pub source_id: NodeId,

    /// Target node ID (edge ends here).
    pub target_id: NodeId,

    /// Type of relationship this edge represents.
    pub edge_type: EdgeType,

    /// Base weight of the edge [0.0, 1.0].
    pub weight: f32,

    /// Confidence in this edge's validity [0.0, 1.0].
    pub confidence: f32,

    /// Knowledge domain this edge belongs to.
    pub domain: Domain,

    /// Neurotransmitter weights for modulation.
    pub neurotransmitter_weights: NeurotransmitterWeights,

    /// Whether this edge is an amortized shortcut (learned during dreams).
    pub is_amortized_shortcut: bool,

    /// Steering reward signal from the Steering Subsystem [-1.0, 1.0].
    pub steering_reward: f32,

    /// Number of times this edge has been traversed.
    pub traversal_count: u64,

    /// Timestamp when this edge was created.
    pub created_at: DateTime&lt;Utc&gt;,

    /// Timestamp when this edge was last traversed.
    pub last_traversed_at: Option&lt;DateTime&lt;Utc&gt;&gt;,
}
    </signature>
  </signatures>

  <constraints>
    - weight must be in range [0.0, 1.0]
    - confidence must be in range [0.0, 1.0]
    - steering_reward must be in range [-1.0, 1.0]
    - is_amortized_shortcut defaults to false
    - last_traversed_at is None until first traversal
    - EdgeId uses UUID v4 format
    - All timestamps use UTC
  </constraints>

  <verification>
    - cargo build --package context-graph-core compiles without errors
    - cargo test --package context-graph-core graph_edge passes all tests
    - cargo clippy --package context-graph-core shows no warnings
  </verification>
</definition_of_done>

<pseudo_code>
marblestone.rs (append after EdgeType):
  // Imports for GraphEdge
  use crate::memory_node::NodeId;

  // Type alias
  pub type EdgeId = Uuid;

  // GraphEdge struct with derives and doc comments
  #[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
  pub struct GraphEdge {
    pub id: EdgeId,
    pub source_id: NodeId,
    pub target_id: NodeId,
    pub edge_type: EdgeType,
    pub weight: f32,
    pub confidence: f32,
    pub domain: Domain,
    pub neurotransmitter_weights: NeurotransmitterWeights,
    pub is_amortized_shortcut: bool,
    pub steering_reward: f32,
    pub traversal_count: u64,
    pub created_at: DateTime&lt;Utc&gt;,
    pub last_traversed_at: Option&lt;DateTime&lt;Utc&gt;&gt;,
  }

#[cfg(test)]
mod graph_edge_struct_tests:
  test_struct_fields_exist()
  test_serde_roundtrip()
  test_edge_id_type_alias()
</pseudo_code>

<files_to_create>
  <!-- File already exists -->
</files_to_create>

<files_to_modify>
  <file path="crates/context-graph-core/src/marblestone.rs">Add GraphEdge struct and EdgeId type alias</file>
  <file path="crates/context-graph-core/src/lib.rs">Re-export GraphEdge, EdgeId</file>
</files_to_modify>

<validation_criteria>
  <criterion>GraphEdge struct compiles with all 13 fields</criterion>
  <criterion>EdgeId type alias is defined as Uuid</criterion>
  <criterion>All Marblestone fields present: neurotransmitter_weights, is_amortized_shortcut, steering_reward</criterion>
  <criterion>Serde Serialize/Deserialize traits work correctly</criterion>
  <criterion>Clone, Debug, PartialEq traits are implemented</criterion>
  <criterion>Doc comments include performance characteristics</criterion>
  <criterion>All fields are public for direct access</criterion>
</validation_criteria>

<test_commands>
  <command>cargo build --package context-graph-core</command>
  <command>cargo test --package context-graph-core graph_edge -- --nocapture</command>
  <command>cargo clippy --package context-graph-core -- -D warnings</command>
</test_commands>
</task_spec>
```

## Implementation Notes

### PRD Section 4.2 Reference (GraphEdge)
```
source,target:UUID, edge_type:Semantic|Temporal|Causal|Hierarchical|Relational,
weight,confidence:f32[0,1], nt_weights:{excitatory,inhibitory,modulatory}[0,1],
is_amortized_shortcut:bool, steering_reward:f32[-1,1],
domain:Code|Legal|Medical|Creative|Research|General
```

### Marblestone Architecture Fields
1. **neurotransmitter_weights**: Modulates edge weight based on domain context
2. **is_amortized_shortcut**: True if edge was learned during dream consolidation (shortcuts 3+ hop paths)
3. **steering_reward**: Feedback signal from the Steering Subsystem (Gardener, Curator, Assessor)

### Amortized Shortcuts (from constitution.yaml)
```yaml
amortized:
  trigger: "3+ hop path traversed ≥5×"
  weight: "product(path_weights)"
  confidence: "≥0.7"
```

---

*Task ID: TASK-M02-010*
*Module: 02 - Core Infrastructure*
*Layer: Foundation*
