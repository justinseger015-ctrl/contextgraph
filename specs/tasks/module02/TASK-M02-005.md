# TASK-M02-005: Define MemoryNode Struct

```xml
<task_spec id="TASK-M02-005" version="1.0">
<metadata>
  <title>Define MemoryNode Struct</title>
  <status>blocked</status>
  <layer>foundation</layer>
  <module>module-02</module>
  <sequence>5</sequence>
  <priority>critical</priority>
  <estimated_hours>2</estimated_hours>
  <implements>
    <item>REQ-CORE-002: MemoryNode requirements</item>
    <item>TECH-CORE-002 Section 2.1: MemoryNode specification</item>
  </implements>
  <depends_on>
    <task_ref>TASK-M02-001</task_ref>
    <task_ref>TASK-M02-003</task_ref>
    <task_ref>TASK-M02-004</task_ref>
  </depends_on>
  <estimated_complexity>medium</estimated_complexity>
</metadata>

<context>
MemoryNode is the core data structure representing a single knowledge unit in the Context Graph. It contains content, embedding vector, Johari quadrant classification, importance metrics, emotional valence, temporal information, and rich metadata. This struct is the primary entity stored in the graph and is central to all retrieval and learning operations.
</context>

<input_context_files>
  <file purpose="JohariQuadrant dependency">crates/context-graph-core/src/johari.rs</file>
  <file purpose="NodeMetadata dependency">crates/context-graph-core/src/metadata.rs</file>
  <file purpose="ValidationError dependency">crates/context-graph-core/src/memory_node.rs</file>
  <file purpose="PRD reference for node structure">docs2/contextprd.md</file>
</input_context_files>

<prerequisites>
  <check>TASK-M02-001 (JohariQuadrant) is complete</check>
  <check>TASK-M02-003 (NodeMetadata) is complete</check>
  <check>TASK-M02-004 (ValidationError) is complete</check>
</prerequisites>

<scope>
  <in_scope>
    - MemoryNode struct definition with 10 fields
    - NodeId type alias for Uuid
    - EmbeddingVector type alias for Vec&lt;f32&gt;
    - DEFAULT_EMBEDDING_DIM constant (1536)
    - MAX_CONTENT_SIZE constant (1MB)
    - Serde Serialize/Deserialize derives
    - Clone, Debug, PartialEq derives
    - Doc comments with performance characteristics
  </in_scope>
  <out_of_scope>
    - MemoryNode methods (handled in TASK-M02-006)
    - Persistence/storage (handled in storage tasks)
  </out_of_scope>
</scope>

<definition_of_done>
  <signatures>
    <signature file="crates/context-graph-core/src/memory_node.rs">
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use uuid::Uuid;

use crate::johari::JohariQuadrant;
use crate::metadata::NodeMetadata;

/// Type alias for node identifiers.
pub type NodeId = Uuid;

/// Type alias for embedding vectors.
pub type EmbeddingVector = Vec&lt;f32&gt;;

/// Default embedding dimension (OpenAI text-embedding-3-large compatible).
pub const DEFAULT_EMBEDDING_DIM: usize = 1536;

/// Maximum content size in bytes (1MB).
pub const MAX_CONTENT_SIZE: usize = 1_048_576;

/// A memory node representing a single knowledge unit in the Context Graph.
///
/// # Performance Characteristics
/// - Average serialized size: ~6.5KB (with embedding)
/// - Insert latency target: &lt;1ms
/// - Retrieval latency target: &lt;500μs
///
/// # Fields
/// - `id`: Unique identifier (UUID v4)
/// - `content`: The actual content/knowledge stored (max 1MB)
/// - `embedding`: Dense vector representation (1536 dimensions)
/// - `quadrant`: Johari Window classification
/// - `importance`: Relevance score [0.0, 1.0]
/// - `emotional_valence`: Emotional charge [-1.0, 1.0]
/// - `created_at`: Creation timestamp
/// - `accessed_at`: Last access timestamp
/// - `access_count`: Number of times accessed
/// - `metadata`: Rich metadata container
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct MemoryNode {
    /// Unique identifier for this node.
    pub id: NodeId,

    /// The content/knowledge stored in this node.
    pub content: String,

    /// Dense embedding vector (1536 dimensions by default).
    pub embedding: EmbeddingVector,

    /// Johari Window quadrant classification.
    pub quadrant: JohariQuadrant,

    /// Importance/relevance score [0.0, 1.0].
    pub importance: f32,

    /// Emotional valence [-1.0, 1.0].
    /// Negative = negative emotion, Positive = positive emotion.
    pub emotional_valence: f32,

    /// Timestamp when this node was created.
    pub created_at: DateTime&lt;Utc&gt;,

    /// Timestamp when this node was last accessed.
    pub accessed_at: DateTime&lt;Utc&gt;,

    /// Number of times this node has been accessed.
    pub access_count: u64,

    /// Rich metadata container.
    pub metadata: NodeMetadata,
}
    </signature>
  </signatures>

  <constraints>
    - Embedding dimension default is 1536 per PRD 12-model fusion
    - Content max size is 1MB (1,048,576 bytes) per PRD Section 4.1
    - importance range [0.0, 1.0]
    - emotional_valence range [-1.0, 1.0]
    - All timestamps use UTC
    - NodeId uses UUID v4 format
    - Doc comments must specify performance targets
  </constraints>

  <verification>
    - cargo build --package context-graph-core compiles without errors
    - cargo test --package context-graph-core memory_node passes all tests
    - cargo clippy --package context-graph-core shows no warnings
    - cargo doc --package context-graph-core generates documentation
  </verification>
</definition_of_done>

<pseudo_code>
memory_node.rs (append after ValidationError):
  // Type aliases
  pub type NodeId = Uuid;
  pub type EmbeddingVector = Vec&lt;f32&gt;;

  // Constants
  pub const DEFAULT_EMBEDDING_DIM: usize = 1536;
  pub const MAX_CONTENT_SIZE: usize = 1_048_576; // 1MB

  // MemoryNode struct with derives
  #[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
  pub struct MemoryNode {
    pub id: NodeId,
    pub content: String,
    pub embedding: EmbeddingVector,
    pub quadrant: JohariQuadrant,
    pub importance: f32,
    pub emotional_valence: f32,
    pub created_at: DateTime&lt;Utc&gt;,
    pub accessed_at: DateTime&lt;Utc&gt;,
    pub access_count: u64,
    pub metadata: NodeMetadata,
  }

#[cfg(test)]
mod memory_node_struct_tests:
  test_struct_fields_exist()
  test_serde_roundtrip()
  test_default_embedding_dim_constant()
  test_max_content_size_constant()
</pseudo_code>

<files_to_create>
  <!-- File already exists from TASK-M02-004 -->
</files_to_create>

<files_to_modify>
  <file path="crates/context-graph-core/src/memory_node.rs">Add MemoryNode struct, type aliases, and constants</file>
  <file path="crates/context-graph-core/src/lib.rs">Re-export MemoryNode, NodeId, EmbeddingVector, constants</file>
</files_to_modify>

<validation_criteria>
  <criterion>MemoryNode struct compiles with all 10 fields</criterion>
  <criterion>NodeId type alias is defined as Uuid</criterion>
  <criterion>EmbeddingVector type alias is defined as Vec&lt;f32&gt;</criterion>
  <criterion>DEFAULT_EMBEDDING_DIM constant equals 1536</criterion>
  <criterion>MAX_CONTENT_SIZE constant equals 1,048,576</criterion>
  <criterion>Serde Serialize/Deserialize traits work correctly</criterion>
  <criterion>Clone, Debug, PartialEq traits are implemented</criterion>
  <criterion>Doc comments include performance characteristics</criterion>
  <criterion>All fields are public for direct access</criterion>
</validation_criteria>

<test_commands>
  <command>cargo build --package context-graph-core</command>
  <command>cargo test --package context-graph-core memory_node -- --nocapture</command>
  <command>cargo doc --package context-graph-core --no-deps</command>
</test_commands>
</task_spec>
```

## Implementation Notes

### Performance Characteristics (from PRD)
- Average serialized size: ~6.5KB (dominated by 1536 * 4 = 6144 bytes for embedding)
- Insert latency target: <1ms
- Retrieval latency target: <500μs

### PRD Section 4.1 Reference (KnowledgeNode)
```
id:UUID, content:str[≤65536], embedding:Vec1536, created_at, last_accessed,
importance:f32[0,1], access_count:u32, johari_quadrant, utl_state:{delta_s,delta_c,w_e,phi},
agent_id?, semantic_cluster?, priors_vibe_check:{assumption_embedding[128], domain_priors, prior_confidence}
```

Note: UTL state and priors_vibe_check are handled separately in UTL module tasks.

### Embedding Dimension
The 1536 dimension matches:
- OpenAI text-embedding-3-large
- E7_Code embedding model (1536D AST)
- E8_Graph/GNN model (1536D)

---

*Task ID: TASK-M02-005*
*Module: 02 - Core Infrastructure*
*Layer: Foundation*
