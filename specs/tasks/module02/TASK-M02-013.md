# TASK-M02-013: Create Storage Crate Structure

```xml
<task_spec id="TASK-M02-013" version="1.0">
<metadata>
  <title>Create Storage Crate Structure</title>
  <status>blocked</status>
  <layer>logic</layer>
  <module>module-02</module>
  <sequence>13</sequence>
  <priority>critical</priority>
  <estimated_hours>1.5</estimated_hours>
  <implements>
    <item>TECH-CORE-002 Section 1.2: Crate structure</item>
    <item>TECH-CORE-002 Section 3: Storage layer specification</item>
  </implements>
  <depends_on>
    <task_ref>TASK-M02-006</task_ref>
  </depends_on>
  <estimated_complexity>low</estimated_complexity>
</metadata>

<context>
This task creates the context-graph-storage crate which provides the persistence layer for the Context Graph system. It sets up the module structure, dependencies, and re-exports needed for RocksDB-based storage of MemoryNodes and GraphEdges. This crate bridges between the core domain types and the underlying storage engine.
</context>

<input_context_files>
  <file purpose="Core crate structure reference">crates/context-graph-core/Cargo.toml</file>
  <file purpose="Constitution reference for crate structure">docs2/constitution.yaml</file>
</input_context_files>

<prerequisites>
  <check>TASK-M02-006 (MemoryNode methods) is complete</check>
  <check>crates/ directory exists</check>
</prerequisites>

<scope>
  <in_scope>
    - Create crates/context-graph-storage directory
    - Create Cargo.toml with dependencies: rocksdb, bincode, thiserror, uuid, chrono
    - Create src/lib.rs with module declarations and re-exports
    - Create empty module files: memex.rs, rocksdb_backend.rs, column_families.rs, serialization.rs, indexes.rs
    - Add context-graph-core as workspace dependency
  </in_scope>
  <out_of_scope>
    - Implementation of storage operations (handled in subsequent tasks)
    - StorageError enum implementation (handled in TASK-M02-025)
  </out_of_scope>
</scope>

<definition_of_done>
  <signatures>
    <signature file="crates/context-graph-storage/Cargo.toml">
[package]
name = "context-graph-storage"
version = "0.1.0"
edition = "2021"
description = "Storage layer for Context Graph with RocksDB backend"
license = "MIT"

[dependencies]
context-graph-core = { path = "../context-graph-core" }
rocksdb = "0.22"
bincode = "1.3"
thiserror = "1.0"
uuid = { version = "1.6", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
tokio = { version = "1.35", features = ["sync"] }

[dev-dependencies]
tempfile = "3.10"
    </signature>
    <signature file="crates/context-graph-storage/src/lib.rs">
//! Context Graph Storage Layer
//!
//! This crate provides persistent storage for the Context Graph system
//! using RocksDB as the underlying storage engine.
//!
//! # Modules
//! - `memex`: Storage trait abstraction
//! - `rocksdb_backend`: RocksDB implementation
//! - `column_families`: Column family definitions
//! - `serialization`: Bincode serialization utilities
//! - `indexes`: Secondary index operations

pub mod column_families;
pub mod indexes;
pub mod memex;
pub mod rocksdb_backend;
pub mod serialization;

// Re-export core types for convenience
pub use context_graph_core::{
    johari::JohariQuadrant,
    marblestone::{Domain, EdgeType, GraphEdge, NeurotransmitterWeights},
    memory_node::{MemoryNode, NodeId, EmbeddingVector, ValidationError},
    metadata::{Modality, NodeMetadata},
};
    </signature>
  </signatures>

  <constraints>
    - rocksdb version 0.22 or later for latest features
    - bincode for efficient binary serialization
    - tempfile for test isolation
    - Modules should be empty files with TODO comments
    - Re-exports should cover all core types needed by storage consumers
  </constraints>

  <verification>
    - cargo build --package context-graph-storage compiles without errors
    - cargo test --package context-graph-storage runs (even with no tests)
    - All modules are importable
  </verification>
</definition_of_done>

<pseudo_code>
Directory structure:
  crates/context-graph-storage/
    ├── Cargo.toml
    └── src/
        ├── lib.rs
        ├── memex.rs        (empty placeholder)
        ├── rocksdb_backend.rs  (empty placeholder)
        ├── column_families.rs  (empty placeholder)
        ├── serialization.rs    (empty placeholder)
        └── indexes.rs          (empty placeholder)

Cargo.toml:
  [package]
  name = "context-graph-storage"
  version = "0.1.0"
  edition = "2021"

  [dependencies]
  context-graph-core = { path = "../context-graph-core" }
  rocksdb = "0.22"
  bincode = "1.3"
  thiserror = "1.0"
  uuid = { version = "1.6", features = ["v4", "serde"] }
  chrono = { version = "0.4", features = ["serde"] }
  serde = { version = "1.0", features = ["derive"] }
  serde_json = "1.0"
  tokio = { version = "1.35", features = ["sync"] }

  [dev-dependencies]
  tempfile = "3.10"

lib.rs:
  //! Crate documentation

  pub mod column_families;
  pub mod indexes;
  pub mod memex;
  pub mod rocksdb_backend;
  pub mod serialization;

  // Re-exports
  pub use context_graph_core::{...};

memex.rs:
  //! Memex storage trait abstraction.
  // TODO: Implement in TASK-M02-026

rocksdb_backend.rs:
  //! RocksDB storage backend implementation.
  // TODO: Implement in TASK-M02-016, TASK-M02-017, TASK-M02-018

column_families.rs:
  //! RocksDB column family definitions.
  // TODO: Implement in TASK-M02-015

serialization.rs:
  //! Bincode serialization utilities.
  // TODO: Implement in TASK-M02-014

indexes.rs:
  //! Secondary index operations.
  // TODO: Implement in TASK-M02-023
</pseudo_code>

<files_to_create>
  <file path="crates/context-graph-storage/Cargo.toml">Crate manifest with dependencies</file>
  <file path="crates/context-graph-storage/src/lib.rs">Library root with module declarations</file>
  <file path="crates/context-graph-storage/src/memex.rs">Empty placeholder for Memex trait</file>
  <file path="crates/context-graph-storage/src/rocksdb_backend.rs">Empty placeholder for RocksDB backend</file>
  <file path="crates/context-graph-storage/src/column_families.rs">Empty placeholder for column families</file>
  <file path="crates/context-graph-storage/src/serialization.rs">Empty placeholder for serialization</file>
  <file path="crates/context-graph-storage/src/indexes.rs">Empty placeholder for indexes</file>
</files_to_create>

<files_to_modify>
  <file path="Cargo.toml">Add context-graph-storage to workspace members (if using workspace)</file>
</files_to_modify>

<validation_criteria>
  <criterion>Cargo.toml has rocksdb, bincode dependencies</criterion>
  <criterion>lib.rs exports all required modules</criterion>
  <criterion>Crate compiles without errors</criterion>
  <criterion>Re-exports from context-graph-core work correctly</criterion>
  <criterion>All placeholder modules exist and are importable</criterion>
</validation_criteria>

<test_commands>
  <command>cargo build --package context-graph-storage</command>
  <command>cargo test --package context-graph-storage</command>
  <command>cargo doc --package context-graph-storage --no-deps</command>
</test_commands>
</task_spec>
```

## Implementation Notes

### Workspace Configuration
If the project uses a Cargo workspace (likely given the crates/ structure), ensure the workspace Cargo.toml includes:
```toml
[workspace]
members = [
    "crates/context-graph-core",
    "crates/context-graph-storage",
]
```

### RocksDB Version
Using rocksdb 0.22 which provides:
- Column family support
- Transactions
- Optimized iterators
- Bloom filters

### Module Responsibilities
| Module | Responsibility | Implemented In |
|--------|----------------|----------------|
| memex.rs | Storage trait abstraction | TASK-M02-026 |
| rocksdb_backend.rs | RocksDB implementation | TASK-M02-016, 017, 018 |
| column_families.rs | CF definitions | TASK-M02-015 |
| serialization.rs | Bincode serde | TASK-M02-014 |
| indexes.rs | Secondary indexes | TASK-M02-023 |

---

*Task ID: TASK-M02-013*
*Module: 02 - Core Infrastructure*
*Layer: Logic*
